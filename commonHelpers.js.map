{"version":3,"file":"commonHelpers.js","sources":["../src/index.js"],"sourcesContent":["import axios from 'axios';\nimport SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\nimport iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\n\nconst elements = {\n  form: document.querySelector('#search-form'),\n  input: document.querySelector('input'),\n  formContainer: document.querySelector('.gallery'),\n  upButton: document.querySelector('.round-button'),\n  guardJs: document.querySelector('.for_upButton'),\n  loader: document.getElementById('loader'),\n};\n\nlet query = '';\nlet page = 1;\nlet simpleLightBox;\nconst perPage = 40;\nlet isLoading = false;\nconst BASE_URL = 'https://pixabay.com/api/';\n\nasync function fetchImages(inputValue, page) {\n  const params = new URLSearchParams({\n    key: '38393469-c3ed0194fa41e0d5130fcf9c2',\n    q: inputValue,\n    image_type: 'photo',\n    orientation: 'horizontal',\n    safesearch: true,\n    per_page: perPage,\n    page: `${page}`,\n  });\n\n  try {\n    const response = await axios.get(`${BASE_URL}?${params}`);\n    if (response.status !== 200) {\n      throw new Error(`Error: ${response.status} ${response.statusText}`);\n    }\n    const data = response.data;\n    if (!data.hits || data.hits.length === 0) {\n      throw new Error('No images found');\n    }\n    return data;\n  } catch (error) {\n    console.error('Error fetching images:', error);\n    throw error;\n  }\n}\n\nelements.form.addEventListener('submit', onFormSubmit);\nsimpleLightBox = new SimpleLightbox('.gallery a');\n\nconst options = {\n  root: null,\n  rootMargin: '300px',\n  threshold: 0,\n};\n\nconst observer = new IntersectionObserver(handlerPagination, options);\n\nelements.upButton.addEventListener('click', scrollTop);\n\nasync function onFormSubmit(e) {\n  e.preventDefault();\n  elements.loader.style.display = 'block';\n  const inputValue = elements.input.value.trim();\n  if (inputValue === query) {\n    iziToast.info({\n      title: 'Invalid input',\n      message: `The previous ${query} request has already been received, please enter a new search parameter`,\n      position: 'topRight',\n    });\n    elements.loader.style.display = 'none';\n    return;\n  }\n  elements.formContainer.innerHTML = '';\n\n  if (!inputValue) {\n    iziToast.warning({\n      title: 'Warning',\n      message: 'Please, fill the main field',\n      position: 'topRight',\n      color: 'red',\n    });\n    elements.loader.style.display = 'none';\n    return;\n  }\n\n  query = inputValue;\n  page = 1;\n  elements.formContainer.innerHTML = '';\n  try {\n    observer.observe(elements.guardJs);\n    const { hits, totalHits } = await fetchImages(inputValue, page);\n    if (totalHits === 0) {\n      iziToast.error({\n        title: 'Error',\n        message:\n          'Sorry, there are no images matching your search query. Please try again.',\n        position: 'topRight',\n        color: 'red',\n      });\n      elements.loader.style.display = 'none';\n      return;\n    }\n\n    elements.formContainer.innerHTML = createMarkup(hits);\n    simpleLightBox.refresh();\n    elements.input.value = '';\n    handlerPagination([{ isIntersecting: true }], observer);\n    iziToast.success({\n      title: 'Success',\n      message: `Hooray! We found ${totalHits} images 😍😍😍`,\n      position: 'topRight',\n      color: 'green',\n    });\n  } catch (error) {\n    console.log(error);\n    // iziToast.error({\n    //   title: 'Error',\n    //   message: 'Something went wrong. Please try again later.',\n    //   position: 'bottomCenter',\n    // });\n  } finally {\n    elements.loader.style.display = 'none';\n  }\n}\n\nfunction createMarkup(arr) {\n  return arr\n    .map(\n      ({\n        webformatURL,\n        largeImageURL,\n        tags,\n        likes,\n        views,\n        comments,\n        downloads,\n      }) => `\n       <li class=\"photo-card\">\n        <a href=\"${largeImageURL}\">\n          <img class=\"photo-img\" src=\"${webformatURL}\" alt=\"${tags}\" loading=\"lazy\" />\n        </a>\n        <div class=\"info\">\n          <p class=\"info-item\"><b>Likes</b>${likes}</p>\n          <p class=\"info-item\"><b>Views</b>${views}</p>\n          <p class=\"info-item\"><b>Comments</b>${comments}</p>\n          <p class=\"info-item\"><b>Downloads</b>${downloads}</p>\n        </div>\n      </li>`\n    )\n    .join('');\n}\n\nfunction scrollTop() {\n  window.scrollTo({\n    top: 0,\n    behavior: 'smooth',\n  });\n  elements.upButton.style.visibility = 'hidden';\n}\n\nasync function handlerPagination(entries, observer) {\n  if (!isLoading) {\n    for (let entry of entries) {\n      if (entry.isIntersecting) {\n        isLoading = true;\n        try {\n          page += 1;\n          const { hits, totalHits } = await fetchImages(query, page);\n          elements.formContainer.insertAdjacentHTML(\n            'beforeend',\n            createMarkup(hits)\n          );\n          simpleLightBox.refresh();\n          const totalPages = Math.ceil(totalHits / perPage);\n\n          if (page >= totalPages) {\n            iziToast.info({\n              title: 'Info',\n              message:\n                \"We're sorry, but you've reached the end of search results.\",\n              position: 'topRight',\n              color: 'blue',\n            });\n            elements.upButton.style.visibility = 'visible';\n            observer.unobserve(elements.guardJs);\n          }\n        } catch (error) {\n          console.log(error);\n          // elements.upButton.style.visibility = 'visible';\n          // iziToast.error({\n          //   title: 'Error',\n          //   message:\n          //     \"We're sorry, but you've reached the end of search results\",\n          //   position: 'topRight',\n          // });\n        } finally {\n          elements.loader.style.display = 'none';\n          isLoading = false;\n        }\n      }\n    }\n  }\n}\n"],"names":["elements","query","page","simpleLightBox","perPage","isLoading","BASE_URL","fetchImages","inputValue","params","response","axios","data","error","onFormSubmit","SimpleLightbox","options","observer","handlerPagination","scrollTop","e","iziToast","hits","totalHits","createMarkup","arr","webformatURL","largeImageURL","tags","likes","views","comments","downloads","entries","entry","totalPages"],"mappings":"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"}